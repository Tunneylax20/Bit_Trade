<h1>Welcome <%= @user.user_name %></h1>
<p>USD balance: $<%= number_with_precision(@user.current_usd_balance, :precision => 2, :delimiter => ',') %></p>
<p>BTC balance: <%= @user.current_btc_balance %></p>

<p>Total Balance: $<%= number_with_precision(@user.total_balance, :precision => 2, :delimiter => ',') %> </p>

<p> Gain/Loss: %<%= number_with_precision((@user.total_balance/25000) - 1, :precision => 4, :delimiter => ',') %> </p>


<script type="text/javascript">
  function updateTotal(){

    var quantity = document.getElementById('qty').value;
    var current_price = document.getElementById('current_price').value;
    
    document.getElementById('total').value = quantity * current_price ; 
  }
</script>

<form action="/users/<%= @user.id %>/transactions" method="POST">
<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />

  <label>
    Buy: 
    <input type="radio" name="buy" value="0" checked="true"/>   
  </label> <br>

  <label>
    Sell:  
    <input type="radio" name="buy" value="1"/>   
  </label> <br>

  <label>
    QTY: 
    <input id="qty" type="integer" name="btc_total" value="1" onkeyup="updateTotal()"/>
  </label> <br>

  <label>
    Current Price:
    <input id="current_price" type="integer" name="price" value=<%=get_current_price%> readonly="true"/>
  </label> <br>

  <label>
    Total: 
    <input id="total" type="text" name="usd_total" readonly="true" value=<%=get_current_price%> />
  </label><br>

  <button>Submit Transaction</button>
  
  <p><%= flash[:error] %></p>

</form>

<table class="trxns">
  <caption>Transaction History</caption>
    <tr class="table_head"> 
      <th>Transaction</th>
      <th>BTC Quantity</th>
      <th>USD Total</th>
      <th>Price</th>
    </tr>
  
  <% @transactions.each do |transaction|%>
    <tr>
      <td><%= transaction.id %></td>
      <td><%= number_with_precision(transaction.btc_total, :precision => 2, :delimiter => ',')  %></td>
      <td>$<%= number_with_precision(transaction.usd_total, :precision => 2, :delimiter => ',')%></td>
      <td>$<%= number_with_precision(transaction.price, :precision => 2, :delimiter => ',') %></td>
    </tr>
  <% end %>

</table>


<p><%= link_to "Edit My Info", edit_user_path(@user) %></p> 

<%= form_tag user_path(@user), method: "delete" do %>
  <%= submit_tag("Delete My Account") %>
<% end %>